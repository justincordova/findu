generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model blocks {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  blocker_id String    @db.Uuid
  blocked_id String    @db.Uuid
  created_at DateTime? @default(now()) @db.Timestamptz(6)

  @@unique([blocker_id, blocked_id])
  @@index([blocked_id], map: "idx_blocks_blocked")
  @@index([blocker_id], map: "idx_blocks_blocker")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model likes {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  from_user    String    @db.Uuid
  to_user      String    @db.Uuid
  is_superlike Boolean?  @default(false)
  created_at   DateTime? @default(now()) @db.Timestamptz(6)

  @@unique([from_user, to_user])
  @@index([from_user], map: "idx_likes_from_user")
  @@index([to_user], map: "idx_likes_to_user")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model matches {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user1      String    @db.Uuid
  user2      String    @db.Uuid
  matched_at DateTime? @default(now()) @db.Timestamptz(6)
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  user_min   String?   @default(dbgenerated("\nCASE\n    WHEN (user1 < user2) THEN user1\n    ELSE user2\nEND")) @db.Uuid
  user_max   String?   @default(dbgenerated("\nCASE\n    WHEN (user1 > user2) THEN user1\n    ELSE user2\nEND")) @db.Uuid
  chats      chats[]

  @@unique([user_min, user_max])
}

model subscriptions {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id    String    @db.Uuid
  plan_name  String
  start_date DateTime? @default(now()) @db.Timestamptz(6)
  end_date   DateTime? @db.Timestamptz(6)
  is_active  Boolean?  @default(true)
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  updated_at DateTime? @default(now()) @db.Timestamptz(6)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model profiles {
  user_id            String    @id(map: "user_profiles_pkey") @db.Uuid
  avatar_url         String?
  campus             String?
  school             String
  bio                String?
  age                Int?
  birthdate          DateTime? @db.Date
  gender             String?
  pronouns           String?
  major              String?
  grad_year          Int?
  interests          String[]
  intent             String?
  looking_for_gender String[]
  min_age            Int?
  max_age            Int?
  spotify_url        String?
  instagram_url      String?
  created_at         DateTime? @default(now()) @db.Timestamptz(6)
  updated_at         DateTime? @default(now()) @db.Timestamptz(6)
  username           String?   @unique(map: "user_profiles_username_key")
}

model campuses {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  unitid     BigInt?   @unique
  name       String    @unique
  city       String?
  state      String?
  predeg     Int?
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  updated_at DateTime? @default(now()) @db.Timestamptz(6)
}

model donations {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id    String    @db.Uuid
  amount     Decimal?  @db.Decimal
  created_at DateTime? @default(now()) @db.Timestamptz(6)
}

model chats {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  match_id   String?   @db.Uuid
  sender_id  String    @db.Uuid
  message    String
  is_read    Boolean?  @default(false)
  sent_at    DateTime? @default(now()) @db.Timestamptz(6)
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  matches    matches?  @relation(fields: [match_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([match_id], map: "idx_chats_match")
  @@index([sender_id], map: "idx_chats_sender")
}
